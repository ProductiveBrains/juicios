<%- include ("partials/_header") %>


    <div class="container mt-3">
        <div class="row mb-2">
            <div class="col-12">
                <h3 class="text-info">Listado de Personas </h3>
            </div>
        </div>
        <div class="row animated flipInY">
            <div class="col-12 py-3" style="background-color: #D3D3D5;">
                <table id="tablaPersonal" class="table table-striped table-bordered dt-responsive nowrap"
                    style="width:100%">
                    <thead>
                        <tr>
                            <th>Acciones</th>
                            <th>CUIL</th>
                            <th>DNI</th>
                            <th>Apellido</th>
                            <th>Nombre</th>
                            <th>Localidad</th>
                            <th>Judiciales</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>

    </div>


    <style>
        td {
            padding: 0.2em 0.2em !important;
        }

        tr {
            text-align: center !important;
        }

        .bg-mirage {
            background: #16222a;
            background: -webkit-linear-gradient(to right, #3a6073, #16222a);
            background: linear-gradient(to right, #3a6073, #16222a);
        }

        .bg-fondodatatable {
            background-color: #f3f3f3;
        }

        table#jornales.dataTable thead:hover {
            background-color: #ffa;
        }

        table#jornales.dataTable td:hover {
            background-color: #ffa;
        }

        table#jornales.dataTable tr:hover {
            background-color: rgb(176, 239, 253);
        }
    </style>

    <script>
        $(document).ready(function () {
            let url = `http://190.106.132.189:3500/api/personas`;

            tablaPersonal=$("#tablaPersonal").DataTable({
                ajax: {
                    url: url,
                    dataSrc: "",
                    async: true,
                    // success: function () {
                    //     console.log("cargando datatable");
                    // }
                },
                "columns": [
                    {
                        defaultContent:
                            "<div class='text-center'>" +
                            "<div class='btn-group'>" +
                            "<button class='btn btn-warning btn-sm btnHacerLitigante mr-3'data-toggle='tooltip' data-placement='top' title='Agregar a Lista de Litigantes'>" +
                            "<i class='fas fa-balance-scale-right'></i>" +
                            "</button>" +
                            "<button class='btn btn-primary btn-sm btnInformacionPersona ml-1'data-toggle='tooltip' data-placement='top' title='Ver: Informacion completa'>" +
                            "<i class='far fa-eye'></i>" +
                            "</button>" +
                            "<button class='btn btn-info btn-sm btnEditar ml-1 mr-3'data-toggle='tooltip' data-placement='top' title='Editar: Datos de Persona'>" +
                            "<i class='fas fa-pencil-alt'></i>" +
                            "</button>" +
                            "<button class='btn btn-danger btn-sm btnBorrar' data-toggle='tooltip' data-placement='left' title='Borrar Persona'>" +
                            "<i class='fas fa-trash-alt'></i>" +
                            "</button>" +
                            "</div>" +
                            "</div>",
                    },
                    { data: "CUIL" },
                    { data: "DNI" },
                    { data: "apellido" },
                    { data: "nombre" },
                    { data: "localidad" },
                    { data: "judiciales" },
                ],
                pageLength: 5,
                lengthMenu: [
                    [5, 10, 20, 50, -1],
                    [5, 10, 20, 50, 'Todos']
                ],
                "pagingType": "full_numbers",
                "dom":
                    "<'row'<'col-md-9'B><'col-md-3 text-right'l>>" +
                    "<'row'<'col-md-9 text-left'i><'col-md-3'f>>" +
                    "<'row'<'col-md-12't>><'row'<'col-md-12'p>>",
                buttons: [
                    {
                        extend: 'copy',
                        text: ' <i class="material-icons text-white align-middle">scanner</i> Copiar al Portapapeles',
                        titleAttr: 'Mantene la copia copia de registro en memoria, y pegado donde se te raje',
                    },
                    {
                        extend: 'excel',
                        text: ' <i class="fas fa-file-excel bg-white text-success align-middle"></i> Excel',
                        titleAttr: 'Descarge un XLS del filtrado realizado',

                        orientation: 'landscape',
                        pageSize: 'A4',
                        // messageTop: nombrearchivo,
                        messageBottom: 'PDF created by ProductiveBrains.com - developed by SJAS.',
                        // title: TituloPDF,
                    },
                    {
                        extend: 'pdfHtml5',
                        text: ' <i class="far fa-file-pdf bg-danger text-white align-middle"></i> PDF',
                        titleAttr: 'Abre en una nueva Pestaña el PDF del filtrado realizado',
                    },
                    {
                        extend: 'print',
                        // text: '<i class="fas fa-print fa-2x text-info"></i> Imprimir',
                        text: '<i class="fas fa-print text-info"></i> Imprimir',
                        titleAttr: 'Muestreo para Imprimir',
                    },
                    {
                        extend: 'csv',
                        text: '<i class="fas fa-file-csv text-warning bg-white"></i> CSV',
                        titleAttr: 'Exporte a Valores separados por Comas',
                    },
                    {
                        text: 'JSON',
                        text: '<i class="fab fa-node-js text-warning"></i> Json',
                        action: function (e, dt, button, config) {
                            var data = dt.buttons.exportData();

                            $.fn.dataTable.fileSave(
                                new Blob([JSON.stringify(data)]),
                                'Export.json'
                            );
                        },
                        titleAttr: 'Exporte a Formato Json',
                    }, 'colvis'
                ],
                "language": {
                    "processing": "Procesando...",
                    "lengthMenu": "Mostrar _MENU_ registros",
                    "zeroRecords": "No se encontraron resultados",
                    "emptyTable": "Ningún dato disponible en esta tabla",
                    "info": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                    "infoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                    "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                    "search": "Buscar:",
                    "infoThousands": ",",
                    "loadingRecords": "Cargando...",
                    "paginate": {
                        "first": "Primero",
                        "last": "Último",
                        "next": "Siguiente",
                        "previous": "Anterior"
                    },
                    "aria": {
                        "sortAscending": ": Activar para ordenar la columna de manera ascendente",
                        "sortDescending": ": Activar para ordenar la columna de manera descendente"
                    },
                    "buttons": {
                        "copy": "Copiar",
                        "colvis": "Visibilidad",
                        "collection": "Colección",
                        "colvisRestore": "Restaurar visibilidad",
                        "copyKeys": "Presione ctrl o u2318 + C para copiar los datos de la tabla al portapapeles del sistema. <br \/> <br \/> Para cancelar, haga clic en este mensaje o presione escape.",
                        "copySuccess": {
                            "1": "Copiada 1 fila al portapapeles",
                            "_": "Copiadas %d fila al portapapeles"
                        },
                        "copyTitle": "Copiar al portapapeles",
                        "csv": "CSV",
                        "excel": "Excel",
                        "pageLength": {
                            "-1": "Mostrar todas las filas",
                            "1": "Mostrar 1 fila",
                            "_": "Mostrar %d filas"
                        },
                        "pdf": "PDF",
                        "print": "Imprimir"
                    },
                    "autoFill": {
                        "cancel": "Cancelar",
                        "fill": "Rellene todas las celdas con <i>%d<\/i>",
                        "fillHorizontal": "Rellenar celdas horizontalmente",
                        "fillVertical": "Rellenar celdas verticalmentemente"
                    },
                    "decimal": ",",
                    "searchBuilder": {
                        "add": "Añadir condición",
                        "button": {
                            "0": "Constructor de búsqueda",
                            "_": "Constructor de búsqueda (%d)"
                        },
                        "clearAll": "Borrar todo",
                        "condition": "Condición",
                        "conditions": {
                            "date": {
                                "after": "Despues",
                                "before": "Antes",
                                "between": "Entre",
                                "empty": "Vacío",
                                "equals": "Igual a",
                                "not": "No",
                                "notBetween": "No entre",
                                "notEmpty": "No Vacio"
                            },
                            "moment": {
                                "after": "Despues",
                                "before": "Antes",
                                "between": "Entre",
                                "empty": "Vacío",
                                "equals": "Igual a",
                                "not": "No",
                                "notBetween": "No entre",
                                "notEmpty": "No vacio"
                            },
                            "number": {
                                "between": "Entre",
                                "empty": "Vacio",
                                "equals": "Igual a",
                                "gt": "Mayor a",
                                "gte": "Mayor o igual a",
                                "lt": "Menor que",
                                "lte": "Menor o igual que",
                                "not": "No",
                                "notBetween": "No entre",
                                "notEmpty": "No vacío"
                            },
                            "string": {
                                "contains": "Contiene",
                                "empty": "Vacío",
                                "endsWith": "Termina en",
                                "equals": "Igual a",
                                "not": "No",
                                "notEmpty": "No Vacio",
                                "startsWith": "Empieza con"
                            }
                        },
                        "data": "Data",
                        "deleteTitle": "Eliminar regla de filtrado",
                        "leftTitle": "Criterios anulados",
                        "logicAnd": "Y",
                        "logicOr": "O",
                        "rightTitle": "Criterios de sangría",
                        "title": {
                            "0": "Constructor de búsqueda",
                            "_": "Constructor de búsqueda (%d)"
                        },
                        "value": "Valor"
                    },
                    "searchPanes": {
                        "clearMessage": "Borrar todo",
                        "collapse": {
                            "0": "Paneles de búsqueda",
                            "_": "Paneles de búsqueda (%d)"
                        },
                        "count": "{total}",
                        "countFiltered": "{shown} ({total})",
                        "emptyPanes": "Sin paneles de búsqueda",
                        "loadMessage": "Cargando paneles de búsqueda",
                        "title": "Filtros Activos - %d"
                    },
                    "select": {
                        "1": "%d fila seleccionada",
                        "_": "%d filas seleccionadas",
                        "cells": {
                            "1": "1 celda seleccionada",
                            "_": "$d celdas seleccionadas"
                        },
                        "columns": {
                            "1": "1 columna seleccionada",
                            "_": "%d columnas seleccionadas"
                        }
                    },
                    "thousands": "."
                },
            });

        })
    </script>

    <!-- Botones -->
    <script>
        //Agregar Litigante
        $(document).on("click", ".btnHacerLitigante", function () {
            // console.log("Litigante Activo");
            fila = $(this).closest("tr");
            cuil = fila.find("td:eq(1)").text();
            apellido = fila.find("td:eq(3)").text();
            nombre = fila.find("td:eq(4)").text();

            Swal.fire({
                title: "Confirma a esta persona como Litigante?",
                text: apellido + " " + nombre + " - C.U.I.L.: " + cuil,
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Si, es Litigante!",
                cancelButtonText: "No, Cancelar!",
            }).then((result) => {
                if (result.isConfirmed) {

                    $.ajax({
                        url: `http://190.106.132.189:3500/api/litigantesiono`,
                        type: "POST",
                        datatype: "json",
                        async: true,
                        data: {
                            CUIL: cuil,
                            VALOR: "SI"
                        },
                        success: function () {
                            // console.log("disparar reload de datatable");
                            tablaPersonal.ajax.reload(null, false);
                        }
                    });
                    Swal.fire(
                        apellido + " " + nombre + " - C.U.I.L.: " + cuil,
                        "Ha sido agregado al Listado de Litigantes.",
                        "success"
                    );
                    // CntDocNAVBAR(); ver si funciona el reload
                    // tablaPersonal.ajax.reload(null, false);
                }
            });

        });
    </script>



    <!-- <script src="/js/ConfirmarOperacion.js"></script> -->
    <%- include ("partials/_footer") %>